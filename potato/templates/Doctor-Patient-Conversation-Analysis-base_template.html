<!DOCTYPE html>
<html lang="en">

  <!--- HEADER GOES BELOW HERE--->

  
    <head>
      <!-- <script src="jquery-3.3.1.min.js"></script> -->

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="content-type" content="text/html;charset=UTF-8">
        <style>
            * {
                box-sizing: border-box;
            }

            .row {
                display: flex;
                flex-direction: column;
            }


            /*                 border:1px solid black;
                border-radius: 5px; */

            
            /* Create two equal columns that sits next to each other */
            .column {
                flex: 50%;
                padding: 15px;
            }
            
            .instance {
                border:1px solid #070707;
                background-color: cccccc;
                border-radius: 5px;
                padding: 15px;
                display: block;
                justify-content: center;
                width: fit-content;
                max-width: 80%;
                text-align: left;
                margin: 0 auto;
                font-size: 15pt;
            }

            .instance p {
                font-weight: bold;
                display: block;
            }

            
            .annotation_schema {
                padding: 5px;                
                display: flex;
                justify-content: center;
                width: 80%;
                text-align: left;
                margin: 0 auto;
            }
           
            
            fieldset {
                background-color: #ededed;
                border:1px solid #160085;
                background-color: cccccc;
                padding: 10px 15px 10px 15px;
            }
            
            legend {
                background-color: #160085;
                color: white;
                padding: 5px 5px;
                font-size: 13pt;
                font-weight: bold;
            }

            input[type="text"] {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;  
                box-sizing: border-box;
                width: 100%;
            }
              
            input {
                margin: 5px;
            }


            .likert li {
                float: left;
                list-style-type: none;
            }


            /* The sidepanel menu */
            .sidepanel {
                min-height: 250px; /* Specify a height */
                width: 0; /* 0 width - change this with JavaScript */
                position: fixed; /* Stay in place */
                z-index: 1; /* Stay on top */
                top: 95px;
                left: 1px;
                background-color: #111; /* Black*/
                overflow-x: hidden; /* Disable horizontal scroll */
                padding-top: 10px; /* Place content 60px from the top */
                padding-bottom: 20px;
                transition: 0.5s; /* 0.5 second transition effect to slide in the sidepanel */
            }

            /* The sidepanel links */
            .sidepanel a {
                padding: 8px 8px 8px 32px;
                text-decoration: none;
                font-size: 55px;
                color: #ffffff; /* #818181; */
                display: block;
                transition: 0.3s;
            }

            /* When you mouse over the navigation links, change their color */
            .sidepanel a:hover {
                color: #f1f1f1;
            }

            /* When you mouse over the navigation links, change their color */
            .sidepanel table {
                color: #ffffff;
                font-size: 20px;
                /*padding: 8px 8px 18px 62px;*/
                margin-left: 20px;
                margin-top: 10px;
                border-spacing: 10px;
            }
            
            .sidepanel td, th  {
                color: #ffffff;
                padding: 5px;
            }

            .sidepanel tr:nth-child(even) {
                background-color: #333333;
            }
                        
            
            /* Position and style the close button (top right corner) */
            .sidepanel .closebtn {
                position: absolute;
                top: 0;
                right: 25px;
                font-size: 36px;
                margin-left: 50px;
            }

            /* Style the button that is used to open the sidepanel */
            .openbtn {
                cursor: pointer;
                /*
                font-size: 20px;                
                background-color: #111;
                color: white;
                padding: 10px 15px;
                border: none;*/
            }

            .openbtn:hover {
                background-color: #444;
            } 

            /* The instructions */
            .instructions {
                /* width: 0; */ /* 0 width - change this with JavaScript */
                transition: 0.5s; /* 0.5 second transition effect to slide in the sidepanel */
                overflow-y: hidden; /* Disable horizontal scroll */
                border:1px solid #070707;
                background-color: cccccc;
                border-radius: 5px;
                padding: 15px;
                display: block;
                justify-content: center;
                width: fit-content;
                max-width: 80%;
                text-align: left;
                margin: 0 auto;
                font-size: 14pt;               
            }

            
            /* Position and style the close button (top right corner) */
            .instructions .closebtn {
                position: absolute;
                top: 0;
                right: 25px;
                font-size: 36px;
                margin-left: 50px;
            }

            /* Style the button that is used to open the sidepanel */
            .instructions .openbtn {
                cursor: pointer;
                /*
                font-size: 20px;                
                background-color: #111;
                color: white;
                padding: 10px 15px;
                border: none;*/
            }

            .span_container {
              border-width:3px;
              border-style:solid;
              border: 2px solid black;
              position: relative;
              border-radius: 5px;
              padding: 2px 5px;
              background-color: pink;
            }
            
            .span_label {
            position: absolute;
            top: -12px;
            left: 5px;
            font-size: 7px;
            padding: 1px 1px;
            border-radius: 3px;
            background-color: pink;
            border: 2px solid red;
            text-align: center;
            }            
            
        </style>
    </head>

    


  <!--- HEADER GOES ABOVE HERE--->
  
  <body>



    <input type="hidden" name="username" id="username" value="{{username}}">
    <input type="hidden" name="instance_id" id="instance_id" value="{{instance_id}}">
    <input type="hidden" name="alert_time_each_instance" id="alert_time_each_instance" value="{{alert_time_each_instance}}">
    <p id="timecounter" hidden>Time spent:</p>

    <div id="mySidepanel" class="sidepanel">
      <a href="javascript:void(0)" class="closebtn" target_id="mySidepanel" onclick="closeNav(this.getAttribute('target_id'))">&times;</a>
      <table><tr><th>Key</th><th>Description</th></tr><tr><td style="text-align: center;">&#8592;</td><td>Move backward</td></tr><tr><td style="text-align: center;">&#8594;</td><td>Move forward</td></tr><tr><td style="text-align: center;">1</td><td>observer_competence: low</td></tr><tr><td style="text-align: center;">2</td><td>observer_competence: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>observer_competence: medium</td></tr><tr><td style="text-align: center;">4</td><td>observer_competence: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>observer_competence: high</td></tr><tr><td style="text-align: center;">6</td><td>observer_competence: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_competence: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_competence: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_competence: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_competence: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_competence: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_competence: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>observer_agency: low</td></tr><tr><td style="text-align: center;">2</td><td>observer_agency: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>observer_agency: medium</td></tr><tr><td style="text-align: center;">4</td><td>observer_agency: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>observer_agency: high</td></tr><tr><td style="text-align: center;">6</td><td>observer_agency: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_agency: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_agency: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_agency: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_agency: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_agency: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_agency: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>observer_communicator: low</td></tr><tr><td style="text-align: center;">2</td><td>observer_communicator: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>observer_communicator: medium</td></tr><tr><td style="text-align: center;">4</td><td>observer_communicator: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>observer_communicator: high</td></tr><tr><td style="text-align: center;">6</td><td>observer_communicator: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_communicator: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_communicator: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_communicator: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_communicator: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_communicator: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_communicator: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_respect: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_respect: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_respect: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_respect: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_respect: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_respect: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_empathy: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_empathy: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_empathy: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_empathy: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_empathy: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_empathy: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_warmth: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_warmth: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_warmth: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_warmth: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_warmth: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_warmth: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_info: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_info: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_info: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_info: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_info: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_info: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_support: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_support: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_support: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_support: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_support: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_support: not applicable</td></tr><tr><td style="text-align: center;">1</td><td>patient_partner: low</td></tr><tr><td style="text-align: center;">2</td><td>patient_partner: slightly low</td></tr><tr><td style="text-align: center;">3</td><td>patient_partner: medium</td></tr><tr><td style="text-align: center;">4</td><td>patient_partner: slightly high</td></tr><tr><td style="text-align: center;">5</td><td>patient_partner: high</td></tr><tr><td style="text-align: center;">6</td><td>patient_partner: not applicable</td></tr></table>
    </div>

    <div id="Statpanel" class="sidepanel">
      <a href="javascript:void(0)" class="closebtn" target_id="Statpanel" onclick="closeNav(this.getAttribute('target_id'))">&times;</a>
      <table><tr><th> </th><th> </th></tr><tr><td style="text-align: center;">Annotated instances</td><td>{{statistics_nav['Annotated instances']}}</td></tr><tr><td style="text-align: center;">Total working time</td><td>{{statistics_nav['Total working time']}}</td></tr><tr><td style="text-align: center;">Average time on each instance</td><td>{{statistics_nav['Average time on each instance']}}</td></tr><tr><td style="text-align: center;">Agreement</td><td>{{statistics_nav['Agreement']}}</td></tr></table>
    </div>
    
    <script>
      document.addEventListener('keyup', function (event) {
          var active_id = document.activeElement.id;
          var active_type = document.activeElement.getAttribute('type');
          if (active_id == 'go_to' | active_type == 'text') return;

          //first check whether this keyboard input is a shortcut for checkboxes
          var checkboxes = document.querySelectorAll('input[type=checkbox]');
          var radios = document.querySelectorAll('input[type=radio]');
          var x = event.key.toLowerCase();

          for (var i = 0; i < checkboxes.length; i++) {
              //alert(checkboxes[i].value)
              if(x === checkboxes[i].value){
                  checkboxes[i].checked = !checkboxes[i].checked;
                  if (checkboxes[i].onclick != null) checkboxes[i].onclick.apply(checkboxes[i]);
                  return;
              };
          }
          for (var i = 0; i < radios.length; i++) {
              //alert(checkboxes[i].value)
              if(x === radios[i].value){
                  radios[i].checked = !radios[i].checked;
                  if (radios[i].onclick != null) radios[i].onclick.apply(radios[i]);
                  return;
              };
          }

          // Each time we process a user's key presses, track who is doing
          // it by grabbing the hidden firstname and lastname fields
          get_new_instance(event);          
      });

      function getSelectedText() {
          var text = "";
          if (typeof window.getSelection != "undefined") {
              text = window.getSelection().toString();
          } else if (typeof document.selection != "undefined" && document.selection.type == "Text") {
              text = document.selection.createRange().text;
          }
          return text;
      }

      function surroundSelection(selectionLabel, selectionColor)  {
          //var span = document.createElement("span");
          //span.style.fontWeight = "bold";
          //span.style.color = "green";
   
          if (window.getSelection) {
              var sel = window.getSelection();

              // Check that we're labeling something in the instance text that
              // we want to annotate
              if (sel.anchorNode.parentElement) {

                  if (sel.anchorNode.parentElement.getAttribute("name") != "instance_text") {
                      
                      // See if this text was already wrapped with the currently
                      // selected class label and if so, remove it
                      var parentOfSelection = sel.anchorNode.parentElement

                      if (parentOfSelection.getAttribute("selection_label") == selectionLabel) {
                          // Remove the div tag that has the span's annotation label
                          $( parentOfSelection ).find("div").remove();
                          // Remove the span tag that has the highlight box
                          $( parentOfSelection.firstChild ).unwrap();
                      }

                      return;
                  }
              }
              else {
                  // alert("no parent element");
                  return;
              }
              
              // Otherwise, we're going to be adding a new span annotation, if
              // the user has selected some non-empty part of th text
              if (sel.rangeCount && sel.toString().trim().length > 0) {                 

                  tsc = selectionColor.replace(")", ", 0.25)")
                  
                  var span = document.createElement("span");
                  span.className = "span_container";
                  span.setAttribute("selection_label", selectionLabel);
                  span.setAttribute("style", "background-color:rgb" + tsc + ";");
                  console.log(selectionColor);
                  
                  var label = document.createElement("div");
                  label.className = "span_label";
                  label.textContent = selectionLabel;
                  label.setAttribute("style", "background-color:white;"
                                    + "border:2px solid rgb" + selectionColor + ";");
                  
                  var range = sel.getRangeAt(0).cloneRange();
                  range.surroundContents(span);
                  sel.removeAllRanges();
                  sel.addRange(range);
                  span.appendChild(label);
              }
          }
      }

      function changeSpanLabel(checkbox, spanLabel, spanColor) {
          // Listen for when the user has highlighted some text (only when the label is checked)
          document.onmouseup = function() {
              if (checkbox.checked){
                  surroundSelection(spanLabel, spanColor);
              }
          }
      }

      // Listen for when the user has highlighted some text
      // document.onmouseup = function() { surroundSelection("Undefined"); } 

    </script>
    <script>
      function barValue(range,sibling) {
          // function used to obtain value for range input
          sibling.value = range.value;
          //var x = document.getElementsByClassName(range.className);
          //var i;
          //for (i=0: i < x.length; i++) {
          //    if(x[i].value != range.value) x[i]
          //}
      }
    </script>

    <script>
      function onlyOne(checkbox) {
	  // this function is used for the single-choice setting
	  //alert(checkbox.className)
	  var x = document.getElementsByClassName(checkbox.className);
	  var i;
	  for (i = 0; i < x.length; i++) {
	      if(x[i].value != checkbox.value) x[i].checked = false;
	  }
      }
    </script>


    <script>
      function whetherNone(checkbox) {
	  // this function is used to uncheck all the other labels when "None" is checked
	  //alert(checkbox.className)
	  var x = document.getElementsByClassName(checkbox.className);
	  var i;
	  for (i = 0; i < x.length; i++) {
              if(checkbox.value == "None" && x[i].value != "None") x[i].checked = false;
              if(checkbox.value != "None" && x[i].value == "None") x[i].checked = false;
          }

      }
    </script>


    <script>
      function click_to_next() {
          // Gacky code to simulate the submit button as a keyboard event
          // and not have two separate paths to handle keyboard and mouse
          // events
          var e = $.Event('keyup');
          e.key = "ArrowRight";
          
          get_new_instance(e);
      }

      function click_to_prev() {
          // Gacky code to simulate the submit button as a keyboard event
          // and not have two separate paths to handle keyboard and mouse
          // events
          var e = $.Event('keyup');
          e.key = "ArrowLeft";
          
          get_new_instance(e);
      } 
      
    </script>
    
    {{annotation}}
    
    <script>
      window.onunload = check_close;
      function check_close() {
          // console.error("session closed");
          var post_req = {
              is_close: "closed"
          }
          post(post_req);
      }
    </script>

    <script>
      // Set the date we're counting down to
      var countDownDate = new Date().getTime();

      // Update the count down every 1 second
      var x = setInterval(function() {

          // Get today's date and time
          var now = new Date().getTime();

          // Find the distance between now and the count down date
          var distance = now - countDownDate;

          // Time calculations for days, hours, minutes and seconds
          var days = Math.floor(distance / (1000 * 60 * 60 * 24));
          var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          var seconds = Math.floor((distance % (1000 * 60)) / 1000);
          var total_seconds = Math.floor(distance / 1000);

          // Output the result in an element with id="timecounter"

          document.getElementById("timecounter").innerHTML = "Time spent: " + days + "d " + hours + "h "
              + minutes + "m " + seconds + "s ";

          // TODO: add configurations for alert message and maximum time spent on each instance
          // If the count down is over, write some text

          var alert_time_each_instance = document.getElementById("alert_time_each_instance").value;
          if (total_seconds % alert_time_each_instance == 0) {
              //clearInterval(x);
              //document.getElementById("timecounter").innerHTML = "EXPIRED";
              alert("You have spent " + total_seconds + " seconds on this instance")
          }

      }, 1000);
    </script>
    
    <script>
      // We submit a new post to the same (user/annotate) endpoint
      function post(params) {
          
          // The rest of this code assumes you are not using a library.
          // It can be made less wordy if you use one.
          var form = document.createElement("form");
          form.setAttribute("method", "post");
          form.setAttribute("action", "annotate");
          
          var hiddenField = document.createElement("input");
          hiddenField.setAttribute("type", "hidden");
          hiddenField.setAttribute("name", "email");
          hiddenField.setAttribute("value", document.getElementById('username').value);
          form.appendChild(hiddenField);
          
          for (var key in params) {
              if (params.hasOwnProperty(key)) {
                  var hiddenField = document.createElement("input");
                  hiddenField.setAttribute("type", "hidden");
                  hiddenField.setAttribute("name", key);
                  hiddenField.setAttribute("value", params[key]);
                  
                  form.appendChild(hiddenField);
              }
          }

          // Stuff all the current annotations into attributes for processing on the server side
          $('form input, form select, form textarea').each(
              function(index){  
                  var input = $(this);
                  
                  if (input.attr('type') == 'checkbox' || input.attr('type') == 'radio') {
                      if (input.is(":checked")) {
                          // Stuff all the input fields into something for the post
                          var hiddenField = document.createElement("input");
                          hiddenField.setAttribute("type", "hidden");
                          hiddenField.setAttribute("name", input.attr('name'));
                          hiddenField.setAttribute("value", input.attr('value'));
                          form.appendChild(hiddenField);
                      }
                  }
                  else if (input.attr('type') == 'text' || input.attr('type') == 'number') {
                      var hiddenField = document.createElement("input");
                      hiddenField.setAttribute("type", "hidden");
                      hiddenField.setAttribute("name", input.attr('name'));
                      hiddenField.setAttribute("value", input[0].value);
                      form.appendChild(hiddenField);                                        
                  }
                  else if (input.attr('type') == 'range') {
                      var hiddenField = document.createElement("input");
                      hiddenField.setAttribute("type", "hidden");
                      hiddenField.setAttribute("name", input.attr('name'));
                      hiddenField.setAttribute("value", input[0].value);
                      form.appendChild(hiddenField);                                        
                  }
                  else if (input.attr('type') == 'select-one') {
                      //alert(input[0].value)
                      var hiddenField = document.createElement("input");
                      hiddenField.setAttribute("type", "hidden");
                      hiddenField.setAttribute("name", input.attr('name'));
                      hiddenField.setAttribute("value", input[0].value);
                      form.appendChild(hiddenField);
                  }
                  else {
                      console.log("unknown form type: \"" + input.attr('type') + "\"")
                  }
              }
          );

          // Get all the highlighted text for this instance and marshall that
          // into some kind of representation for the server side
          $(".span_container").first().each(
              function(index) {

                  // we save the outerHTML to accomadate user-defined HTML inputs,
                  // otherwise we just save the plain text
                  if ($(this).parent().parent().attr("name") == "instance_text"){
                      var annotated_spans = $(this).parent().prop('outerHTML');
                  } else {
                      var annotated_spans = $(this).parent().prop('innerHTML');
                  }

                  // Due to the DJ's inability to write decent Javascript, we're
                  // fully punting on the idea of doing label preprocessing here
                  // and instead shuttling the entire HTML of the instance to
                  // the server for python-based processing. The main issue is
                  // figuring out the precise text offsets of the annotated
                  // spans while dealing with nested DOM elements.
                  var hiddenField = document.createElement("input");
                  hiddenField.setAttribute("type", "hidden");
                  hiddenField.setAttribute("name", "span-annotation");
                  hiddenField.setAttribute("value", annotated_spans);
                  form.appendChild(hiddenField);
                  //console.log(annotated_spans)
              }
          );

          
          document.body.appendChild(form);
          form.submit();
      }


       /**
       * Validate if the input answers meet certain rules
       * along with any relevant key presses to request a new instance to
       * annotate.
       */
      function validate_answers() {

          // check if all the right labels are checked
          //alert({{instance_obj|tojson}}['id'])
          var inputs =  document.querySelectorAll('input[validation=right_label]');
          for (var i = 0; i < inputs.length; ++i) {
            if (inputs[i].getAttribute('validation') == 'right_label' && inputs[i].checked == false){
                alert(inputs[i].name + " must be selected to proceed");
                //alert(instance_obj.id)
                return false;
            }
          }


          // identify all the fieldsets and check if all the required forms are filled
          var fields = document.getElementsByTagName('fieldset');
          for (var i = 0; i < fields.length; ++i) {
                var inputs = fields[i].querySelectorAll('input[validation=required], select[validation=required], textarea[validation=required]');

                // continue if all there's no required inputs in the current field set
                if (inputs.length == 0){
                    continue;
                }
                //var required = true;
                // check if the current form requires inputs
                //if (inputs[0].getAttribute('validation') == 'required'){
                //    required= true;
                //}


                checked_flag = false;
                for (var j = 0; j < inputs.length; ++j) {
                    // if a right_label is not selected, display an error msg and return false
                    //if (inputs[j].getAttribute('validation') == 'right_label' && inputs[j].checked == false) {
                    //    alert(inputs[j].name + " must be selected to proceed");
                        //alert(instance_obj.id)
                    //    return false;
                    //}
                    // if the input is for a span annotation schema, check if the at least some span is annotated or if the
                    // bad_text label is selected
                    if (inputs[j].getAttribute("for_span") == "True"){
                        //alert($(".span_container").length);
                        if ($(".span_container").length > 0) {
                            checked_flag = true;
                            break;
                        } else if (inputs[j].name.slice(-8) == "bad_text" && inputs[j].checked == true){
                            checked_flag = true;
                            break;
                        }
                    }


                    // if any of the labels is checked, set checked_flag as true;
                    if (inputs[j].getAttribute("for_span") != "True" && inputs[j].checked == true) {

                        checked_flag = true;
                        break;
                    }

                    // if the input_type is number, text, select or textarea, check if it's empty
                    // todo: the current way might not work well if there are mixed textinput and radio buttons under a sample fieldset
                    if (inputs[j].type == "text" || inputs[j].tagName == "TEXTAREA" || inputs[j].type == "number" || inputs[j].type == "select-one") {
                        if (inputs[j].value.length == 0){
                            alert(inputs[j].name + " must be completed to proceed");
                            return false;
                        }
                        else{
                            checked_flag = true;
                        }
                    }
                }


                // if this form requires inputs, but nothing is checked, display an error msg and return false
                if (checked_flag == false){
                    alert("You must answer the following item to proceed: " + inputs[0].className);
                    return false;
                }
                //alert(instance_obj.id)
          }
          return true;
      }


      /**
       * Sends the current state of the instance's annotation to the server,
       * along with any relevant key presses to request a new instance to
       * annotate.
       */
      function get_new_instance(event) {
          var x = event.key;
          var action = ""
          var ism = ""

          //console.log(x)
          //console.log(firstname)
          //console.log(lastname)
          if (x == "ArrowLeft") { // Spacebar
              action = "prev_instance";
          }
          else if (x == "ArrowRight") {
              if (validate_answers() == true) {
                  action = "next_instance";
              }
              else{
                  return;
              }
          }
          else {
              // console.log("Unknown key press", event)
              return
          }
          
          var instance_id = document.getElementById('instance_id').value
          var time_string = document.getElementById("timecounter").innerHTML //get time spent on this instance
          //time_string = '-1'
          var post_req = {
              label: ism,
              src: action,
              instance_id: instance_id,
              behavior_time_string: time_string
          }

          // Sends the post message to the server which will let us update the
          // currently displayed content
          post(post_req)
      }

    </script>

    <script>
      $(document).ready(function(){
          $('[data-toggle="tooltip"]').tooltip();
      });
    </script>


   
    <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-3">
      <div class="container-fluid">
        <a href="#" class="navbar-brand mr-3">Doctor Patient Conversation Analysis</a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav">
            <a href="#" class="nav-item nav-link active">Home</a>
            
            <a role="button" href="#" class="nav-item nav-link openbtn" target_id="Statpanel" width = "475px" onclick="openNav(this.getAttribute('target_id'),this.getAttribute('width'))">Statistics</a>
            <a role="button" href="#" class="nav-item nav-link openbtn" target_id="mySidepanel" onclick="openNav(this.getAttribute('target_id'))">Help</a>
          </div>
          <div class="p-2 bd-highlight text-secondary align-middle">
            Finished {{finished}}/{{total_count}}
          </div>
          <div class="p-2 bd-highlight text-secondary align-middle">
            Current_id {{instance_id}}
          </div>
          <div class="p-2 bd-highlight text-secondary align-middle">
            <form action="/annotate" method="post">
              <fieldset>
                <input type="hidden" name="firstname" id="a" value="{{firstname}}">
                <input type="hidden" name="lastname" id="b" value="{{lastname}}">
                 <input type="hidden" name="email" id="c" value="{{username}}">
                <input type="hidden" name="src" id="src" value="go_to">
                <input type="number" name="go_to" id="go_to" value="" onfocusin="user_input()" onfocusout="user_input_leave()" max={{total_count}} min=0 required>
                <input type="submit" value="go">
              </fieldset>
            </form>
          </div>
          <div class="navbar-nav ml-auto">
            <div class="text-secondary align-middle">Currently logged in as {{username}}</div>
          </div>
        </div>
      </div>    
    </nav>
    <div class="container-fluid">

      <!--- LAYOUT GOES BELOW HERE --->

      <style>
    * {
        box-sizing: border-box;
   
    }

    .row {
        display: flex;
        flex-direction: row;
    }


    /*                 border:1px solid black;
        border-radius: 5px; */

    
    /* Create two equal columns that sits next to each other */
    .column {
        flex: 50%;
        padding: 0px;
    }

    .instance_text {
    width: 100%;
    padding: 10px;
    box-sizing: content-box;
    }

    .form-container {
    height: 300px; 
    overflow-y: scroll;
    }


    .annotation_schema {
        width: 100%;
        /* padding: 15px; */
        box-sizing: content-box;width: 100%;
        display: block; /* Change to block to make forms stack vertically */
        margin-bottom: 0px;
    }

        .annotation_schema form fieldset {
        display: flex;
        flex-direction: row;
        align-items: start;
    }

    .annotation_schema form fieldset legend {
        margin-right: 10px; 
    }

    .annotation_schema form fieldset label {
        margin-right: 10px; 
    }

    
    .instance {
        border:1px solid #070707;
        background-color: cccccc;
        border-radius: 5px;
        padding: 15px;
        display: block;
        justify-content: center;
        width: fit-content;
        max-width: 120%;
        text-align: left;
        margin: 0 auto;
        font-size: 15pt;
    }

    .instance p {
        font-weight: bold;
        display: block;
    }

    
    /* .annotation_schema {
        padding: 5px;                
        display: flex;
        justify-content: center;
        width: 80%;
        text-align: left;
        margin: 0 auto;
    } */
   
    
    fieldset {
        background-color: #fefffa;
        border:1px solid #f6f4fc;
        background-color: cccccc;
        padding: 10px 15px 10px 15px;
    }
    
    legend {
        background-color: #4c8aab;
        color: white;
        padding: 0;
        /* padding: 5px 5px; */
        font-size: 10pt;
        font-weight: normal;
    }

    input[type="text"] {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;  
        box-sizing: border-box;
        width: 100%;
    }
      
    input {
        margin: 5px;
    }


    .likert li {
        float: inline-start;
        list-style-type: none;
    }


    /* The sidepanel menu */
    .sidepanel {
        min-height: 250px; /* Specify a height */
        width: 0; /* 0 width - change this with JavaScript */
        position: fixed; /* Stay in place */
        z-index: 1; /* Stay on top */
        top: 95px;
        left: 1px;
        background-color: #77b1c1; /* Black*/
        overflow-x: hidden; /* Disable horizontal scroll */
        padding-top: 10px; /* Place content 60px from the top */
        padding-bottom: 20px;
        transition: 0.5s; /* 0.5 second transition effect to slide in the sidepanel */
    }

    /* The sidepanel links */
    .sidepanel a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 55px;
        color: #ffffff; /* #818181; */
        display: block;
        transition: 0.3s;
    }

    /* When you mouse over the navigation links, change their color */
    .sidepanel a:hover {
        color: #f1f1f1;
    }

    /* When you mouse over the navigation links, change their color */
    .sidepanel table {
        color: #ffffff;
        font-size: 20px;
        /*padding: 8px 8px 18px 62px;*/
        margin-left: 20px;
        margin-top: 10px;
        border-spacing: 10px;
    }
    
    .sidepanel td, th  {
        color: #ffffff;
        padding: 5px;
    }

    .sidepanel tr:nth-child(even) {
        background-color: #a4c6cb;
    }
                
    
    /* Position and style the close button (top right corner) */
    .sidepanel .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
    }

    /* Style the button that is used to open the sidepanel */
    .openbtn {
        cursor: pointer;
        /*
        font-size: 20px;                
        background-color: #111;
        color: white;
        padding: 10px 15px;
        border: none;*/
    }

    .openbtn:hover {
        background-color: #444;
    } 

    /* The instructions */
    .instructions {
        /* width: 0; */ /* 0 width - change this with JavaScript */
        transition: 0.5s; /* 0.5 second transition effect to slide in the sidepanel */
        overflow-y: hidden; /* Disable horizontal scroll */
        border:1px solid #070707;
        background-color: cccccc;
        border-radius: 5px;
        padding: 15px;
        display: block;
        justify-content: center;
        width: fit-content;
        max-width: 80%;
        text-align: left;
        margin: 0 auto;
        font-size: 14pt;               
    }

    
    /* Position and style the close button (top right corner) */
    .instructions .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
    }

    /* Style the button that is used to open the sidepanel */
    .instructions .openbtn {
        cursor: pointer;
        /*
        font-size: 20px;                
        background-color: #111;
        color: white;
        padding: 10px 15px;
        border: none;*/
    }

    .span_container {
      border-width:3px;
      border-style:solid;
      border: 2px solid rgb(0, 0, 0);
      position: relative;
      border-radius: 5px;
      padding: 2px 5px;
      background-color: rgb(132, 131, 133);
    }
    
    .span_label {
    position: absolute;
    top: -12px;
    left: 5px;
    font-size: 7px;
    padding: 1px 1px;
    border-radius: 3px;
    background-color: rgb(192, 229, 255);
    border: 2px solid rgb(148, 210, 255);
    text-align: center;
    }            
    
</style>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <div name="context_text" class="instance">
                        <div name="instance_text" style="max-width: 400px;">
                            {{instance | safe}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <div class="annotation_schema" style="max-width: 400px;">
                        <form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how competent do you think the patient sounds?</legend>      <input class="observer_competence" type="radio" id="observer_competence:::low" name="observer_competence:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::low" >low</label>      <input class="observer_competence" type="radio" id="observer_competence:::slightly low" name="observer_competence:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::slightly low" >slightly low</label>      <input class="observer_competence" type="radio" id="observer_competence:::medium" name="observer_competence:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::medium" >medium</label>      <input class="observer_competence" type="radio" id="observer_competence:::slightly high" name="observer_competence:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::slightly high" >slightly high</label>      <input class="observer_competence" type="radio" id="observer_competence:::high" name="observer_competence:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::high" >high</label>      <input class="observer_competence" type="radio" id="observer_competence:::not applicable" name="observer_competence:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how competent do you think the doctor views you?</legend>      <input class="patient_competence" type="radio" id="patient_competence:::low" name="patient_competence:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::low" >low</label>      <input class="patient_competence" type="radio" id="patient_competence:::slightly low" name="patient_competence:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::slightly low" >slightly low</label>      <input class="patient_competence" type="radio" id="patient_competence:::medium" name="patient_competence:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::medium" >medium</label>      <input class="patient_competence" type="radio" id="patient_competence:::slightly high" name="patient_competence:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::slightly high" >slightly high</label>      <input class="patient_competence" type="radio" id="patient_competence:::high" name="patient_competence:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::high" >high</label>      <input class="patient_competence" type="radio" id="patient_competence:::not applicable" name="patient_competence:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how much agency do you think the patient has?</legend>      <input class="observer_agency" type="radio" id="observer_agency:::low" name="observer_agency:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::low" >low</label>      <input class="observer_agency" type="radio" id="observer_agency:::slightly low" name="observer_agency:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::slightly low" >slightly low</label>      <input class="observer_agency" type="radio" id="observer_agency:::medium" name="observer_agency:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::medium" >medium</label>      <input class="observer_agency" type="radio" id="observer_agency:::slightly high" name="observer_agency:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::slightly high" >slightly high</label>      <input class="observer_agency" type="radio" id="observer_agency:::high" name="observer_agency:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::high" >high</label>      <input class="observer_agency" type="radio" id="observer_agency:::not applicable" name="observer_agency:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how much agency do you think the doctor thinks you have?</legend>      <input class="patient_agency" type="radio" id="patient_agency:::low" name="patient_agency:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::low" >low</label>      <input class="patient_agency" type="radio" id="patient_agency:::slightly low" name="patient_agency:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::slightly low" >slightly low</label>      <input class="patient_agency" type="radio" id="patient_agency:::medium" name="patient_agency:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::medium" >medium</label>      <input class="patient_agency" type="radio" id="patient_agency:::slightly high" name="patient_agency:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::slightly high" >slightly high</label>      <input class="patient_agency" type="radio" id="patient_agency:::high" name="patient_agency:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::high" >high</label>      <input class="patient_agency" type="radio" id="patient_agency:::not applicable" name="patient_agency:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how good of a communicator is the patient?</legend>      <input class="observer_communicator" type="radio" id="observer_communicator:::low" name="observer_communicator:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::low" >low</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::slightly low" name="observer_communicator:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::slightly low" >slightly low</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::medium" name="observer_communicator:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::medium" >medium</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::slightly high" name="observer_communicator:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::slightly high" >slightly high</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::high" name="observer_communicator:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::high" >high</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::not applicable" name="observer_communicator:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how good of a communicator do you think the doctor views you?</legend>      <input class="patient_communicator" type="radio" id="patient_communicator:::low" name="patient_communicator:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::low" >low</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::slightly low" name="patient_communicator:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::slightly low" >slightly low</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::medium" name="patient_communicator:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::medium" >medium</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::slightly high" name="patient_communicator:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::slightly high" >slightly high</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::high" name="patient_communicator:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::high" >high</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::not applicable" name="patient_communicator:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how respectful is the doctor?</legend>      <input class="patient_respect" type="radio" id="patient_respect:::low" name="patient_respect:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::low" >low</label>      <input class="patient_respect" type="radio" id="patient_respect:::slightly low" name="patient_respect:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::slightly low" >slightly low</label>      <input class="patient_respect" type="radio" id="patient_respect:::medium" name="patient_respect:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::medium" >medium</label>      <input class="patient_respect" type="radio" id="patient_respect:::slightly high" name="patient_respect:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::slightly high" >slightly high</label>      <input class="patient_respect" type="radio" id="patient_respect:::high" name="patient_respect:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::high" >high</label>      <input class="patient_respect" type="radio" id="patient_respect:::not applicable" name="patient_respect:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how empathetic is the doctor?</legend>      <input class="patient_empathy" type="radio" id="patient_empathy:::low" name="patient_empathy:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::low" >low</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::slightly low" name="patient_empathy:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::slightly low" >slightly low</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::medium" name="patient_empathy:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::medium" >medium</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::slightly high" name="patient_empathy:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::slightly high" >slightly high</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::high" name="patient_empathy:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::high" >high</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::not applicable" name="patient_empathy:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how warm is the doctor?</legend>      <input class="patient_warmth" type="radio" id="patient_warmth:::low" name="patient_warmth:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::low" >low</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::slightly low" name="patient_warmth:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::slightly low" >slightly low</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::medium" name="patient_warmth:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::medium" >medium</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::slightly high" name="patient_warmth:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::slightly high" >slightly high</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::high" name="patient_warmth:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::high" >high</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::not applicable" name="patient_warmth:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how informative is the doctor?</legend>      <input class="patient_info" type="radio" id="patient_info:::low" name="patient_info:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_info:::low" >low</label>      <input class="patient_info" type="radio" id="patient_info:::slightly low" name="patient_info:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_info:::slightly low" >slightly low</label>      <input class="patient_info" type="radio" id="patient_info:::medium" name="patient_info:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_info:::medium" >medium</label>      <input class="patient_info" type="radio" id="patient_info:::slightly high" name="patient_info:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_info:::slightly high" >slightly high</label>      <input class="patient_info" type="radio" id="patient_info:::high" name="patient_info:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_info:::high" >high</label>      <input class="patient_info" type="radio" id="patient_info:::not applicable" name="patient_info:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_info:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how supportive is the doctor?</legend>      <input class="patient_support" type="radio" id="patient_support:::low" name="patient_support:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_support:::low" >low</label>      <input class="patient_support" type="radio" id="patient_support:::slightly low" name="patient_support:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_support:::slightly low" >slightly low</label>      <input class="patient_support" type="radio" id="patient_support:::medium" name="patient_support:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_support:::medium" >medium</label>      <input class="patient_support" type="radio" id="patient_support:::slightly high" name="patient_support:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_support:::slightly high" >slightly high</label>      <input class="patient_support" type="radio" id="patient_support:::high" name="patient_support:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_support:::high" >high</label>      <input class="patient_support" type="radio" id="patient_support:::not applicable" name="patient_support:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_support:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how much does the doctor build partnership?</legend>      <input class="patient_partner" type="radio" id="patient_partner:::low" name="patient_partner:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::low" >low</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::slightly low" name="patient_partner:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::slightly low" >slightly low</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::medium" name="patient_partner:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::medium" >medium</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::slightly high" name="patient_partner:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::slightly high" >slightly high</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::high" name="patient_partner:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::high" >high</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::not applicable" name="patient_partner:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::not applicable" >not applicable</label><br/>  </fieldset>
</form>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 



<div class="row">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-12">
  
          <div name="context_text" class="instance">
            <div name="instance_text" style="max-width:400px;">
              {{instance | safe}}
            </div>
          </div>
            <div class="annotation_schema" style="display: grid;grid-template-columns: repeat(1, 1fr);gap: 20px;grid-auto-rows: auto; max-width:400px;">
                <form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how competent do you think the patient sounds?</legend>      <input class="observer_competence" type="radio" id="observer_competence:::low" name="observer_competence:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::low" >low</label>      <input class="observer_competence" type="radio" id="observer_competence:::slightly low" name="observer_competence:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::slightly low" >slightly low</label>      <input class="observer_competence" type="radio" id="observer_competence:::medium" name="observer_competence:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::medium" >medium</label>      <input class="observer_competence" type="radio" id="observer_competence:::slightly high" name="observer_competence:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::slightly high" >slightly high</label>      <input class="observer_competence" type="radio" id="observer_competence:::high" name="observer_competence:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::high" >high</label>      <input class="observer_competence" type="radio" id="observer_competence:::not applicable" name="observer_competence:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_competence:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how competent do you think the doctor views you?</legend>      <input class="patient_competence" type="radio" id="patient_competence:::low" name="patient_competence:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::low" >low</label>      <input class="patient_competence" type="radio" id="patient_competence:::slightly low" name="patient_competence:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::slightly low" >slightly low</label>      <input class="patient_competence" type="radio" id="patient_competence:::medium" name="patient_competence:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::medium" >medium</label>      <input class="patient_competence" type="radio" id="patient_competence:::slightly high" name="patient_competence:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::slightly high" >slightly high</label>      <input class="patient_competence" type="radio" id="patient_competence:::high" name="patient_competence:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::high" >high</label>      <input class="patient_competence" type="radio" id="patient_competence:::not applicable" name="patient_competence:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_competence:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how much agency do you think the patient has?</legend>      <input class="observer_agency" type="radio" id="observer_agency:::low" name="observer_agency:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::low" >low</label>      <input class="observer_agency" type="radio" id="observer_agency:::slightly low" name="observer_agency:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::slightly low" >slightly low</label>      <input class="observer_agency" type="radio" id="observer_agency:::medium" name="observer_agency:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::medium" >medium</label>      <input class="observer_agency" type="radio" id="observer_agency:::slightly high" name="observer_agency:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::slightly high" >slightly high</label>      <input class="observer_agency" type="radio" id="observer_agency:::high" name="observer_agency:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::high" >high</label>      <input class="observer_agency" type="radio" id="observer_agency:::not applicable" name="observer_agency:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_agency:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how much agency do you think the doctor thinks you have?</legend>      <input class="patient_agency" type="radio" id="patient_agency:::low" name="patient_agency:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::low" >low</label>      <input class="patient_agency" type="radio" id="patient_agency:::slightly low" name="patient_agency:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::slightly low" >slightly low</label>      <input class="patient_agency" type="radio" id="patient_agency:::medium" name="patient_agency:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::medium" >medium</label>      <input class="patient_agency" type="radio" id="patient_agency:::slightly high" name="patient_agency:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::slightly high" >slightly high</label>      <input class="patient_agency" type="radio" id="patient_agency:::high" name="patient_agency:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::high" >high</label>      <input class="patient_agency" type="radio" id="patient_agency:::not applicable" name="patient_agency:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_agency:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From an observer's POV, how good of a communicator is the patient?</legend>      <input class="observer_communicator" type="radio" id="observer_communicator:::low" name="observer_communicator:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::low" >low</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::slightly low" name="observer_communicator:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::slightly low" >slightly low</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::medium" name="observer_communicator:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::medium" >medium</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::slightly high" name="observer_communicator:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::slightly high" >slightly high</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::high" name="observer_communicator:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::high" >high</label>      <input class="observer_communicator" type="radio" id="observer_communicator:::not applicable" name="observer_communicator:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="observer_communicator:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how good of a communicator do you think the doctor views you?</legend>      <input class="patient_communicator" type="radio" id="patient_communicator:::low" name="patient_communicator:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::low" >low</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::slightly low" name="patient_communicator:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::slightly low" >slightly low</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::medium" name="patient_communicator:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::medium" >medium</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::slightly high" name="patient_communicator:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::slightly high" >slightly high</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::high" name="patient_communicator:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::high" >high</label>      <input class="patient_communicator" type="radio" id="patient_communicator:::not applicable" name="patient_communicator:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_communicator:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how respectful is the doctor?</legend>      <input class="patient_respect" type="radio" id="patient_respect:::low" name="patient_respect:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::low" >low</label>      <input class="patient_respect" type="radio" id="patient_respect:::slightly low" name="patient_respect:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::slightly low" >slightly low</label>      <input class="patient_respect" type="radio" id="patient_respect:::medium" name="patient_respect:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::medium" >medium</label>      <input class="patient_respect" type="radio" id="patient_respect:::slightly high" name="patient_respect:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::slightly high" >slightly high</label>      <input class="patient_respect" type="radio" id="patient_respect:::high" name="patient_respect:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::high" >high</label>      <input class="patient_respect" type="radio" id="patient_respect:::not applicable" name="patient_respect:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_respect:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how empathetic is the doctor?</legend>      <input class="patient_empathy" type="radio" id="patient_empathy:::low" name="patient_empathy:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::low" >low</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::slightly low" name="patient_empathy:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::slightly low" >slightly low</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::medium" name="patient_empathy:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::medium" >medium</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::slightly high" name="patient_empathy:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::slightly high" >slightly high</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::high" name="patient_empathy:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::high" >high</label>      <input class="patient_empathy" type="radio" id="patient_empathy:::not applicable" name="patient_empathy:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_empathy:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how warm is the doctor?</legend>      <input class="patient_warmth" type="radio" id="patient_warmth:::low" name="patient_warmth:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::low" >low</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::slightly low" name="patient_warmth:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::slightly low" >slightly low</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::medium" name="patient_warmth:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::medium" >medium</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::slightly high" name="patient_warmth:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::slightly high" >slightly high</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::high" name="patient_warmth:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::high" >high</label>      <input class="patient_warmth" type="radio" id="patient_warmth:::not applicable" name="patient_warmth:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_warmth:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how informative is the doctor?</legend>      <input class="patient_info" type="radio" id="patient_info:::low" name="patient_info:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_info:::low" >low</label>      <input class="patient_info" type="radio" id="patient_info:::slightly low" name="patient_info:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_info:::slightly low" >slightly low</label>      <input class="patient_info" type="radio" id="patient_info:::medium" name="patient_info:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_info:::medium" >medium</label>      <input class="patient_info" type="radio" id="patient_info:::slightly high" name="patient_info:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_info:::slightly high" >slightly high</label>      <input class="patient_info" type="radio" id="patient_info:::high" name="patient_info:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_info:::high" >high</label>      <input class="patient_info" type="radio" id="patient_info:::not applicable" name="patient_info:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_info:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how supportive is the doctor?</legend>      <input class="patient_support" type="radio" id="patient_support:::low" name="patient_support:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_support:::low" >low</label>      <input class="patient_support" type="radio" id="patient_support:::slightly low" name="patient_support:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_support:::slightly low" >slightly low</label>      <input class="patient_support" type="radio" id="patient_support:::medium" name="patient_support:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_support:::medium" >medium</label>      <input class="patient_support" type="radio" id="patient_support:::slightly high" name="patient_support:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_support:::slightly high" >slightly high</label>      <input class="patient_support" type="radio" id="patient_support:::high" name="patient_support:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_support:::high" >high</label>      <input class="patient_support" type="radio" id="patient_support:::not applicable" name="patient_support:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_support:::not applicable" >not applicable</label>  </fieldset>
</form>

<form action="/action_page.php">  <fieldset>  <legend>From the patient's POV, how much does the doctor build partnership?</legend>      <input class="patient_partner" type="radio" id="patient_partner:::low" name="patient_partner:::low" value="1" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::low" >low</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::slightly low" name="patient_partner:::slightly low" value="2" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::slightly low" >slightly low</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::medium" name="patient_partner:::medium" value="3" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::medium" >medium</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::slightly high" name="patient_partner:::slightly high" value="4" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::slightly high" >slightly high</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::high" name="patient_partner:::high" value="5" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::high" >high</label><br/>      <input class="patient_partner" type="radio" id="patient_partner:::not applicable" name="patient_partner:::not applicable" value="6" onclick="onlyOne(this)" validation="">  <label for="patient_partner:::not applicable" >not applicable</label><br/>  </fieldset>
</form>


            </div>
        </div>
      </div>
      <div style="height: 15px;" />
  
    </div>
    <div class="col-md-12">
    </div>
  </div>

  -->

      <!--- LAYOUT GOES ABOVE  --->

      <div>
        <p>
          <div class="text-center">
            <a class="btn btn-secondary" href="#" role="button" onclick="click_to_prev()">Move backward</a>
            <a class="btn btn-secondary" href="#" role="button" onclick="click_to_next()">Move forward</a>
          </div>
        </p>        
      </div>

      <hr>
      <footer>
        <div class="row">
          <div class="col-md-6">
            <p>Copyright &copy; 2022 <a href="https://blablablab.si.umich.edu/">Blablablab</a> </p>
          </div>
          <div class="col-md-12 text-md-right">
            <a href="https://github.com/davidjurgens/potato" class="text-dark">Fork on GitHub</a>
            <span class="text-muted mx-2">|</span> 
            <a href="https://github.com/davidjurgens/potato#cite-us" class="text-dark">Cite Us</a>
          </div>
        </div>
      </footer>
    </div>

    <script>
      /* Set the width of the sidebar to 250px (show it) */
      function openNav(target_id, width = "350px") {
          document.getElementById(target_id).style.width = width;
      }
      
      /* Set the width of the sidebar to 0 (hide it) */
      function closeNav(target_id) {
          document.getElementById(target_id).style.width = "0";
      }

      function closeNav2(target_id) {
          // document.getElementById(target_id).style.height = "20px";
          console.error(document.getElementById(target_id).style.display);
          if (document.getElementById(target_id).style.display == "block" 
              || document.getElementById(target_id).style.display == "") {
              
              document.getElementById(target_id).style.display = "none";
              localStorage.setItem('show_instructions', 'false'); 
          }
          else{
              document.getElementById(target_id).style.display = "block";
              localStorage.setItem('show_instructions', 'true'); 
          }
      }

      /* Keep the instructions hidden/shown across instance transitions based on
         what the user had selected */      
      window.onload = function() {
          var show = localStorage.getItem('show_instructions');
          if (document.getElementById('instructions')) {
              if (show === 'true') {
                  document.getElementById('instructions').style.display = "block";
              }
              else {
                  document.getElementById('instructions').style.display = "none";
              }
          }
      }      

    </script>
  </body>
</html>
